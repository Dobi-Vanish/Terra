<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Создание персонажа - RPG Мир</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Ваш CSS файл -->
  <link rel="stylesheet" href="css/style.css">
  <style>
    .stat-table input {
      width: 70px;
      text-align: center;
    }
    .total-cell {
      background-color: #e9ecef;
      font-weight: bold;
    }
    .race-modifier {
      background-color: #d1ecf1;
    }
    .final-value {
      background-color: #d4edda;
      font-weight: bold;
    }
    .points-counter {
      font-size: 1.1em;
      font-weight: bold;
    }
    .stat-input:invalid {
      border-color: #dc3545;
      box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="index.html">RPG Мир</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Главная</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="races.html">Расы</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="classes.html">Классы</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="religions.html">Религии</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="applications.html">Анкеты</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="mechanics.html">Механики</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="abilities.html">Способности</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="sheet.html">Лист игрока</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="multirace.html">Генератор полукровок</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="diceroller.html">Dice roller</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="map.html">Интерактивная карта</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<div class="container py-4">
  <!-- Заголовок страницы -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="p-4 bg-light border-radius-lg">
        <h1 class="display-4 text-center text-primary mb-3">Создание персонажа</h1>
        <hr class="my-4">
        <div class="row">
          <div class="col-md-8 mx-auto">
            <div class="card border-0 bg-transparent">
              <div class="card-body text-center">
                <p class="card-text">Заполните анкету персонажа, выберите расу и класс, затем распределите характеристики. Система автоматически рассчитает итоговые значения.</p>
                <div class="alert alert-info">
                  <strong>Бюджет характеристик:</strong> <span id="pointsRemaining" class="points-counter">120</span> очков осталось из 120
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Основная форма персонажа -->
  <div class="row">
    <div class="col-12">
      <div class="card race-card">
        <div class="card-header bg-primary text-white">
          <h2 class="h4 mb-0">Анкета персонажа</h2>
        </div>
        <div class="card-body">
          <form id="characterForm">
            <!-- Основная информация -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="characterName" class="form-label">Имя персонажа *</label>
                  <input type="text" class="form-control" id="characterName" required>
                </div>
                <div class="mb-3">
                  <label for="playerName" class="form-label">Имя игрока *</label>
                  <input type="text" class="form-control" id="playerName" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="characterRace" class="form-label">Раса *</label>
                  <select class="form-select" id="characterRace" onchange="updateRaceModifiers()">
                    <option value="">Выберите расу</option>
                    <option value="human">Человек</option>
                    <option value="elf">Эльф</option>
                    <option value="orc">Орк</option>
                    <option value="dwarf">Дварф</option>
                    <option value="hobbit">Хоббит</option>
                    <option value="goblin">Гоблин</option>
                    <option value="ogre">Огр</option>
                    <option value="demon">Бес</option>
                    <option value="naga">Нага</option>
                    <option value="lizardman">Людоящер</option>
                    <option value="draconian">Дракониане</option>
                    <option value="lizard">Лизарды</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="characterGender" class="form-label">Пол *</label>
                  <select class="form-select" id="characterGender" onchange="updateRaceModifiers()">
                    <option value="">Выберите пол</option>
                    <option value="male">Мужской</option>
                    <option value="female">Женский</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="characterClass" class="form-label">Класс *</label>
                  <select class="form-select" id="characterClass">
                    <option value="">Выберите класс</option>
                    <option value="warrior">Воин</option>
                    <option value="mage">Маг</option>
                    <option value="rogue">Вор</option>
                    <option value="cleric">Жрец</option>
                    <option value="ranger">Следопыт</option>
                    <option value="barbarian">Варвар</option>
                    <option value="paladin">Паладин</option>
                    <option value="monk">Монах</option>
                    <option value="druid">Друид</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Таблица характеристик -->
            <h4 class="mb-3">Распределение характеристик</h4>
            <div class="alert alert-warning">
              <strong>Внимание:</strong> Базовое значение не может быть меньше 5 и больше 20. Сумма всех базовых характеристик не должна превышать 120 очков.
            </div>

            <div class="table-responsive">
              <table class="table table-bordered table-hover stat-table">
                <thead class="table-dark">
                <tr>
                  <th>Характеристика</th>
                  <th>Базовое значение</th>
                  <th>Модификатор расы</th>
                  <th>Итоговое значение</th>
                  <th>Описание</th>
                </tr>
                </thead>
                <tbody>
                <!-- Сила -->
                <tr>
                  <td><strong>Сила</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="strengthBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="strengthRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="strengthTotal">10</span>
                  </td>
                  <td><small>Физическая сила, атака в ближнем бою</small></td>
                </tr>
                <!-- Телосложение -->
                <tr>
                  <td><strong>Телосложение</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="constitutionBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="constitutionRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="constitutionTotal">10</span>
                  </td>
                  <td><small>Здоровье, выносливость, хитпоинты</small></td>
                </tr>
                <!-- Выносливость -->
                <tr>
                  <td><strong>Выносливость</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="enduranceBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="enduranceRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="enduranceTotal">10</span>
                  </td>
                  <td><small>Стойкость, перенос усталости и ран</small></td>
                </tr>
                <!-- Ловкость -->
                <tr>
                  <td><strong>Ловкость</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="dexterityBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="dexterityRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="dexterityTotal">10</span>
                  </td>
                  <td><small>Координация, акробатика, точность</small></td>
                </tr>
                <!-- Реакция -->
                <tr>
                  <td><strong>Реакция</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="reactionBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="reactionRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="reactionTotal">10</span>
                  </td>
                  <td><small>Скорость реакции, инициатива в бою</small></td>
                </tr>
                <!-- Восприятие -->
                <tr>
                  <td><strong>Восприятие</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="perceptionBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="perceptionRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="perceptionTotal">10</span>
                  </td>
                  <td><small>Внимательность, обнаружение скрытого</small></td>
                </tr>
                <!-- Интеллект -->
                <tr>
                  <td><strong>Интеллект</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="intelligenceBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="intelligenceRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="intelligenceTotal">10</span>
                  </td>
                  <td><small>Знания, логика, магические навыки</small></td>
                </tr>
                <!-- Мудрость -->
                <tr>
                  <td><strong>Мудрость</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="wisdomBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="wisdomRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="wisdomTotal">10</span>
                  </td>
                  <td><small>Интуиция, проницательность, выживание</small></td>
                </tr>
                <!-- Воля -->
                <tr>
                  <td><strong>Воля</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="willBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="willRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="willTotal">10</span>
                  </td>
                  <td><small>Психическая стойкость, сопротивление</small></td>
                </tr>
                <!-- Дух -->
                <tr>
                  <td><strong>Дух</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="spiritBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="spiritRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="spiritTotal">10</span>
                  </td>
                  <td><small>Магическая энергия, связь с потусторонним</small></td>
                </tr>
                <!-- Харизма -->
                <tr>
                  <td><strong>Харизма</strong></td>
                  <td>
                    <input type="number" step="0.1" class="form-control base-value stat-input"
                           id="charismaBase" value="5" min="5" max="20"
                           onchange="calculateTotals()">
                  </td>
                  <td class="race-modifier">
                    <input type="number" step="0.1" class="form-control race-value stat-input"
                           id="charismaRace" value="0" min="0" max="20" onchange="calculateTotals()">
                  </td>
                  <td class="total-cell final-value">
                    <span id="charismaTotal">10</span>
                  </td>
                  <td><small>Общительность, лидерство, убеждение</small></td>
                </tr>
                </tbody>
              </table>
            </div>

            <!-- Итоговые расчеты -->
            <div class="row mt-4">
              <div class="col-md-6">
                <div class="card bg-light">
                  <div class="card-body">
                    <h5 class="card-title">Производные характеристики</h5>
                    <div class="row">
                      <div class="col-6">
                        <strong>Хитпоинты:</strong>
                      </div>
                      <div class="col-6">
                        <span id="hpTotal"></span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Манапоинты:</strong>
                      </div>
                      <div class="col-6">
                        <span id="manaTotal"></span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Инициатива:</strong>
                      </div>
                      <div class="col-6">
                        <span id="initiativeTotal"></span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Точность:</strong>
                      </div>
                      <div class="col-6">
                        <span id="accuracyTotal"></span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Импульс массы:</strong>
                      </div>
                      <div class="col-6">
                        <span id="massImpulseTotal"></span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Ячейки навыков:</strong>
                      </div>
                      <div class="col-6">
                        <span id="skillSlots"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card bg-info text-white">
                  <div class="card-body">
                    <h5 class="card-title">Сводка характеристик</h5>
                    <div class="row">
                      <div class="col-6">
                        <strong>Сумма базовых:</strong>
                      </div>
                      <div class="col-6">
                        <span id="baseSum">0</span>/120
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Самая высокая:</strong>
                      </div>
                      <div class="col-6">
                        <span id="highestStat">-</span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Самая низкая:</strong>
                      </div>
                      <div class="col-6">
                        <span id="lowestStat">-</span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-6">
                        <strong>Всего очков использовано:</strong>
                      </div>
                      <div class="col-6">
                        <span id="totalUsed">0</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Кнопки отправки -->
            <div class="row mt-4">
              <div class="col-12 text-center">
                <button type="submit" class="btn btn-primary btn-lg me-3">
                  <i class="icon-large">✓</i> Создать персонажа
                </button>
                <button type="reset" class="btn btn-outline-secondary btn-lg" onclick="resetForm()">
                  <i class="icon-large">↺</i> Сбросить
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Ваш основной JS файл -->
<script src="js/script.js"></script>
<!-- Скрипт для калькулятора характеристик -->
<script>
  // Модификаторы рас
  const raceModifiers = {
    human: {
      male: { strength: 6, constitution: 10, endurance: 5, dexterity: 1, reaction: 1, perception: 1, intelligence: 1.6, wisdom: 1, will: 1, spirit: 10, charisma: 1 },
      female: { strength: 5, constitution: 10, endurance: 5, dexterity: 1, reaction: 1, perception: 1, intelligence: 1.6, wisdom: 1, will: 1, spirit: 10, charisma: 1 }
    },
    elf: {
      male: { strength: 5, constitution: 9, endurance: 7, dexterity: 1.5, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1.5, will: 1, spirit: 10, charisma: 1 },
      female: { strength: 4, constitution: 9, endurance: 7, dexterity: 1.5, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1.5, will: 1, spirit: 10, charisma: 1 }
    },
    orc: {
      male: { strength: 7, constitution: 12, endurance: 7, dexterity: 1, reaction: 1, perception: 1.5, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1 },
      female: { strength: 6, constitution: 12, endurance: 7, dexterity: 1, reaction: 1, perception: 1.5, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1 }
    },
    dwarf: {
      male: { strength: 6, constitution: 10, endurance: 5, dexterity: 1, reaction: 1, perception: 0.66, intelligence: 0.6, wisdom: 1, will: 1, spirit: 12, charisma: 1 },
      female: { strength: 5, constitution: 10, endurance: 5, dexterity: 1, reaction: 1, perception: 0.66, intelligence: 0.6, wisdom: 1, will: 1, spirit: 12, charisma: 1 }
    },
    hobbit: {
      male: { strength: 4, constitution: 7, endurance: 5, dexterity: 1.5, reaction: 1.5, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1.5 },
      female: { strength: 4, constitution: 7, endurance: 5, dexterity: 1.5, reaction: 1.5, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1.5 }
    },
    goblin: {
      male: { strength: 3, constitution: 7, endurance: 10, dexterity: 1.5, reaction: 1.5, perception: 1, intelligence: 0.6, wisdom: 1, will: 1, spirit: 10, charisma: 1 },
      female: { strength: 3, constitution: 7, endurance: 10, dexterity: 1.5, reaction: 1.5, perception: 1, intelligence: 0.6, wisdom: 1, will: 1, spirit: 10, charisma: 1 }
    },
    ogre: {
      male: { strength: 10, constitution: 15, endurance: 7, dexterity: 1, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1 },
      female: { strength: 8, constitution: 15, endurance: 7, dexterity: 1, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1 }
    },
    demon: {
      male: { strength: 3, constitution: 8, endurance: 7, dexterity: 1.5, reaction: 1.5, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1.5 },
      female: { strength: 3, constitution: 8, endurance: 7, dexterity: 1.5, reaction: 1.5, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1.5 }
    },
    naga: {
      male: { strength: 7, constitution: 12, endurance: 7, dexterity: 1.5, reaction: 1, perception: 1.5, intelligence: 0.4, wisdom: 1, will: 1.5, spirit: 12.5, charisma: 1 },
      female: { strength: 6, constitution: 12, endurance: 7, dexterity: 1.5, reaction: 1, perception: 1.5, intelligence: 0.4, wisdom: 1, will: 1.5, spirit: 12.5, charisma: 1 }
    },
    lizardman: {
      male: { strength: 5, constitution: 10, endurance: 5, dexterity: 1.5, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1 },
      female: { strength: 4, constitution: 10, endurance: 5, dexterity: 1.5, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 10, charisma: 1 }
    },
    draconian: {
      male: { strength: 10, constitution: 12.5, endurance: 7, dexterity: 1, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 12.5, charisma: 1 },
      female: { strength: 8, constitution: 12.5, endurance: 7, dexterity: 1, reaction: 1, perception: 1, intelligence: 0.4, wisdom: 1, will: 1, spirit: 12.5, charisma: 1 }
    },
    lizard: {
      male: { strength: 6, constitution: 10, endurance: 7, dexterity: 1, reaction: 1, perception: 1, intelligence: 0.6, wisdom: 1, will: 1, spirit: 10, charisma: 1.5 },
      female: { strength: 5, constitution: 10, endurance: 7, dexterity: 1, reaction: 1, perception: 1, intelligence: 0.6, wisdom: 1, will: 1, spirit: 10, charisma: 1.5 }
    }
  };

  function updateRaceModifiers() {
    const race = document.getElementById('characterRace').value;
    const gender = document.getElementById('characterGender').value;

    if (race && gender && raceModifiers[race] && raceModifiers[race][gender]) {
      const modifiers = raceModifiers[race][gender];
      Object.keys(modifiers).forEach(stat => {
        document.getElementById(stat + 'Race').value = modifiers[stat];
      });
    } else {
      // Сброс модификаторов расы
      ['strength', 'constitution', 'endurance', 'dexterity', 'reaction', 'perception', 'intelligence', 'wisdom', 'will', 'spirit', 'charisma'].forEach(stat => {
        document.getElementById(stat + 'Race').value = 1;
      });
    }
    calculateTotals();
  }
  function calculateTotals() {
    const stats = ['strength', 'constitution', 'endurance', 'dexterity', 'reaction', 'perception', 'intelligence', 'wisdom', 'will', 'spirit', 'charisma'];
    let baseSum = 0;
    let highestStat = { name: '', value: -Infinity };
    let lowestStat = { name: '', value: Infinity };

    stats.forEach(stat => {
      const base = parseFloat(document.getElementById(stat + 'Base').value) || 0;
      const race = parseFloat(document.getElementById(stat + 'Race').value) || 0;

      // Итоговое значение = базовое * модификатор расы
      const total = base * race;

      // Округляем до целого в меньшую сторону
      const totalRounded = Math.floor(total);

      // Обновляем отображение итогового значения
      document.getElementById(stat + 'Total').textContent = totalRounded;

      // Считаем сумму базовых характеристик
      baseSum += base;

      // Находим самую высокую и низкую характеристику
      if (totalRounded > highestStat.value) {
        highestStat = { name: stat, value: totalRounded };
      }
      if (totalRounded < lowestStat.value) {
        lowestStat = { name: stat, value: totalRounded };
      }
    });

    // Обновляем счетчик очков
    const pointsRemaining = 120 - baseSum;
    document.getElementById('pointsRemaining').textContent = Math.floor(pointsRemaining);
    document.getElementById('baseSum').textContent = Math.floor(baseSum);
    document.getElementById('totalUsed').textContent = Math.floor(baseSum);

    // Подсвечиваем если очков не хватает или перебор
    const pointsElement = document.getElementById('pointsRemaining');
    if (pointsRemaining < 0) {
      pointsElement.className = 'points-counter text-danger';
    } else if (pointsRemaining === 0) {
      pointsElement.className = 'points-counter text-success';
    } else {
      pointsElement.className = 'points-counter text-info';
    }

    // Обновляем самую высокую и низкую характеристику
    document.getElementById('highestStat').textContent = `${getStatName(highestStat.name)} (${highestStat.value})`;
    document.getElementById('lowestStat').textContent = `${getStatName(lowestStat.name)} (${lowestStat.value})`;

    // Обновляем производные характеристики
    updateDerivedStats();
  }

  function getStatName(stat) {
    const names = {
      strength: 'Сила',
      constitution: 'Телосложение',
      endurance: 'Выносливость',
      dexterity: 'Ловкость',
      reaction: 'Реакция',
      perception: 'Восприятие',
      intelligence: 'Интеллект',
      wisdom: 'Мудрость',
      will: 'Воля',
      spirit: 'Дух',
      charisma: 'Харизма'
    };
    return names[stat] || stat;
  }

  function updateDerivedStats() {
    // Получаем итоговые значения характеристик (уже округленные)
    const conTotal = parseInt(document.getElementById('constitutionTotal').textContent) || 0;
    const strTotal = parseInt(document.getElementById('strengthTotal').textContent) || 0;
    const endTotal = parseInt(document.getElementById('enduranceTotal').textContent) || 0;
    const dexTotal = parseInt(document.getElementById('dexterityTotal').textContent) || 0;
    const reaTotal = parseInt(document.getElementById('reactionTotal').textContent) || 0;
    const intTotal = parseInt(document.getElementById('intelligenceTotal').textContent) || 0;
    const spiTotal = parseInt(document.getElementById('spiritTotal').textContent) || 0;

    // Получаем модификаторы расы
    const conRace = parseFloat(document.getElementById('constitutionRace').value) || 0;
    const spiRace = parseFloat(document.getElementById('spiritRace').value) || 0;

    // Хитпоинты = модификатор телосложения * итоговое телосложение
    const hpTotal = Math.floor(conRace * conTotal);
    document.getElementById('hpTotal').textContent = hpTotal / 10;

    // Манапоинты = модификатор духа * итоговый дух
    const manaTotal = Math.floor(spiRace * spiTotal);
    document.getElementById('manaTotal').textContent = manaTotal / 10;

    // Инициатива = реакция (уже округленная)
    document.getElementById('initiativeTotal').textContent = reaTotal;

    // Ячейки навыков = интеллект / 2 (округление в меньшую сторону)
    const skillSlots = Math.floor(intTotal / 2);
    document.getElementById('skillSlots').textContent = Math.max(1, skillSlots);

    // Точность = (Ловкость + Реакция) / 2 (округление в меньшую сторону)
    const accuracy = Math.floor((dexTotal + reaTotal) / 2);
    document.getElementById('accuracyTotal').textContent = accuracy;

    // Импульс массы тела = (Сила + Телосложение + Выносливость) / 3 (округление в меньшую сторону)
    const massImpulse = Math.floor((strTotal + conTotal + endTotal) / 3);
    document.getElementById('massImpulseTotal').textContent = massImpulse;
  }

  function resetForm() {
    // Сброс всех значений к начальным
    document.getElementById('characterForm').reset();

    // Сброс характеристик к базовым значениям
    const stats = ['strength', 'constitution', 'endurance', 'dexterity', 'reaction', 'perception', 'intelligence', 'wisdom', 'will', 'spirit', 'charisma'];
    stats.forEach(stat => {
      document.getElementById(stat + 'Base').value = 10;
      document.getElementById(stat + 'Race').value = 1;
    });

    // Пересчет итогов
    calculateTotals();
  }

  // Инициализация при загрузке страницы
  document.addEventListener('DOMContentLoaded', function() {
    calculateTotals();

    // Добавляем обработчики для всех полей ввода
    const inputs = document.querySelectorAll('.base-value, .race-value');
    inputs.forEach(input => {
      input.addEventListener('input', calculateTotals);
    });
  });
</script>
</body>
</html>